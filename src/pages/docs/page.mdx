---
title: 微页面
description: 支持使用代码形式编写自定义控件，并进一步开发组合成自定义前端页面。微页面中需要支持快捷调用平台的基础控件，包括并不限于列表视图、记录详情视图、图表、报表。
---

微页面也是一种元数据，可以配置菜单指向微页面。微页面可以使用可视化工具设计，最终保存在软件包中。

## 核心需求

- 低代码快速开发页面
- 提供可视化工具
- 需要支持自定义控件

## 微页面元数据

### 微页面 .page.yml

```yml
name: `pageApiName`
objectApiName: contracts
type: app/record/list/form
renderEngine: amis
schema: `pageApiName`.amis.json
isDefault: true
```

### Amis Schema .amis.json

.amis.json 独立保存，以便在 VS Code 中直接设计Schema。

```json
{
  "type": "page",
  "title": "标题",
  "remark": {
    "title": "标题",
    "body": "这是一段描述问题，注意到了没，还可以设置标题。而且只有点击了才弹出来。",
    "icon": "question-mark",
    "placement": "right",
    "trigger": "click",
    "rootClose": true
  },
  "body": "内容部分. 可以使用 \\${var} 获取变量。如: `\\$date`: ${date}",
  "aside": "边栏部分",
  "toolbar": "工具栏",
  "initApi": "/amis/api/mock2/page/initData"
}
```

### 页面分配 .pageAssignment.yml

```yml
app: contract
profile: user
recordType: null
page: contract-list
mobile: true
```

#### Record To Set Org Default 

```yml
app: null
profile: null
recordType: null
desktop: contract-list-desktop
mobile: contract-list
```

#### Record To Set App Default 

```yml
app: contract
profile: null
recordType: null
desktop: contract-list-desktop
mobile: contract-list
```

#### Record To Set App Profile Default 

```
app: contract
profile: user
recordType: null
desktop: contract-list-desktop
mobile: contract-list
```

## 微页面引擎

系统提供标准的页面接口，可通过插件扩展的方式支持不同的微页面引擎。

- [Baidu Amis](https://github.com/baidu/amis)
- [Alibaba Formliy](https://github.com/alibaba/formily)
- [Redash](https://github.com/getredash/redash)
- [AppSmith](https://github.com/appsmithorg/appsmith)
- [ToolJet](https://github.com/ToolJet/ToolJet)


### 注册自定义组件

```js
import { Builder } from '@builder.io/react'
 
// Register our heading component for use in
// the visual editor
const Heading = props => (
  <h1 className="my-heading">{props.title}</h1>
)
 
Builder.registerComponent(Heading, {
  name: 'Heading',
  inputs: [{ name: 'title', type: 'text' }]
})
```

### 注册微页面引擎

```js
import { Builder } from '@builder.io/react'

// Register amis render 
const Amis = props => {
  const {schema, data} = props;

  return (
    <>
      <div id="amis-root"></div>
      <Script 
        src="https://unpkg.com/amis@1.8.0-beta.2/sdk/sdk.js" 
        onLoad={() => {
          let amis = amisRequire('amis/embed');
          amis.embed('#amis-root', schema, data);
        }}/>
      <link rel="stylesheet" href="https://unpkg.com/amis@1.8.0-beta.2/sdk/sdk.css" />
    </>
  )
}
 
Builder.registerComponent(Amis, {
  name: 'Amis',
  inputs: [
    { name: 'schema', type: 'object' },
    { name: 'data', type: 'object' },
  ]
})
```

## 渲染页面

使用 [BuilderComponent](https://github.com/BuilderIO/builder/tree/main/packages/react) 控件渲染页面

```js
<BuilderComponent 
  model="page" 
  content={pageSchema} 
  data={{
    objectApiName: 'space_users',
    _id: 'bar'
  }}
  context={{
    beforeRender: () => alert('Ready... Go!'),
    lodash: lodash,
  }}
  />
```

## API

```
GET /api/page/:renderEngine/:type?app=xxx&objectApiName=yyy&recordId=zzz
```

## 参考

- [Salesforce Lightning](https://developer.salesforce.com/docs/atlas.en-us.lightning.meta/lightning/intro_lightning.htm)
- [BuilderIO](https://github.com/BuilderIO/builder)