---
title: 微服务
description: 
---

## 微服务协议

支持在软件包中自定义微服务。微服务可以用任何语言编写，运行在任何环境中，但需要统一注册到微服务中心。

### 微服务注册

微服务需注册到微服务中心才能互相调用，包括可以在触发器中调用。

```json
{
    name: "posts",
    version: 1,

    settings: {
        // It means, your HTTP server running on port 5000 and sidecar can reach it on `localhost`
        // The URLs in action/event handlers contains relative URL.
        baseUrl: "http://service.mesh:5000"
    },

    actions: {
        list: {
            params: {
                limit: "number",
                offset: "number"
            },
            // Shorthand handler URL what will be called by sidecar
            handler: "/actions/posts/list"
        }
    },

    events: {
        "user.created": {
            // Shorthand handler URL what will be called by sidecar
            handler: "/events/user.created"
        }
    }
}
```

### 自定义微服务

每个软件包根目录下有一个名为 `package.service.js` 的默认微服务文件，这里可以编写软件包级别的微服务逻辑。

在软件包的元数据文件夹 `main/default` 下有一个自定义微服务文件夹 `services`，可以在该文件夹中添加自定义微服务文件。

比如我们可以把上面 [微服务注册](/docs/services#微服务注册) 中提到的内容写入目录 `main/default/services/posts.service.js` 文件中来为 posts 对象实现一些自定义微服务逻辑。

自定义微服务与软件包默认微服务主要有以下区别：

- 文件名可以自定义，但是必须以 `service.js`后缀命名。
- 服务名称不会自动加前缀。

### 函数（Actions）

服务公开的可调用的方法称为 actions。 

```js
    actions: {
        list: {
            params: {
                limit: "number",
                offset: "number"
            },
            // Shorthand handler URL what will be called by sidecar
            handler: "/actions/posts/list"
        }
    },
```

actions可以使用 broker.call 来调用。 

```js
const res = await broker.call("posts.list", { limit: 10, offset: 0 });
```

### Events

您可以在 events 中订阅事件。

```js
    events: {
        "user.created": {
            // Shorthand handler URL what will be called by sidecar
            handler: "/events/user.created"
        }
    }
```


可以使用broker.emit命令抛出事件。

```js
// The `user` will be serialized to transportation.
broker.emit("user.created", user);
```

## 内核微服务

低代码平台内核需要包含以下内核微服务。

### 软件包服务

安装、升级、卸载软件包，加载软件包中的元数据并发送给 Metadata Service

[了解更多](./service-package)

### 元数据服务

负责汇总和合并元数据，并提供 Metadata API 供前端页面和VSCode插件调用。

[了解更多](./service-metadata)

### 记录服务

根据对象的元数据定义，自动生成记录增删改查API，提供给前端页面调用。

[了解更多](./service-records)

## 参考

- [Salesforce Functions](https://developer.salesforce.com/docs/platform/functions/overview)
- [Moleculer Service](https://moleculer.services/zh/docs/0.14/services.html)
- [Moleculer Sidecar](https://github.com/moleculerjs/sidecar)